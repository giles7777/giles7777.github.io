(this.webpackJsonpprototype=this.webpackJsonpprototype||[]).push([[0],{41:function(e,t,i){e.exports=i(56)},46:function(e,t,i){},56:function(e,t,i){"use strict";i.r(t);var s=i(0),a=i.n(s),n=i(13),r=i.n(n),o=(i(46),i(28)),h=i(7),l=i(11),c=i(16),u=i(15),g=i(14),m=i(2),d=i(34),b=function(){function e(){Object(h.a)(this,e)}return Object(l.a)(e,[{key:"getTemperature",value:function(e,t,i){return 70}},{key:"getHumidity",value:function(e,t,i){return 70}}]),e}(),v=i(17),p=i(35),f=function(){function e(t,i,s,a,n,r,o,l){var c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0;if(Object(h.a)(this,e),this.marked=!1,this.THREE=t,this.radio=i,this.id=s,this.size=n,this.world=a,this.x=r,this.y=o,this.z=l,this.rotx=c,this.roty=u,this.rotz=g,this.state={},this.createMesh(),this.neighbors=[],"undefined"===typeof s)throw new Error("Agent.id must be set")}return Object(l.a)(e,[{key:"setMarked",value:function(e){this.marked=e;for(var t=this.group.children.length-1;t>=0;t--)this.group.remove(this.group.children[t]);if(this.group.add(this.mesh),this.marked){var i=new this.THREE.SphereGeometry(1.3*this.size,24,24,0,2*Math.PI,0,Math.PI/2),s=new this.THREE.MeshBasicMaterial({color:16711680}),a=new this.THREE.Mesh(i,s);a.position.copy(new this.THREE.Vector3(this.x,this.y,this.z-this.size)),a.rotation.x=this.rotx,a.rotation.y=this.roty,a.rotation.z=this.rotz,this.group.add(a)}}},{key:"getMarked",value:function(){return this.marked}},{key:"getState",value:function(){return this.state}},{key:"getPosition",value:function(){return new this.THREE.Vector3(this.x,this.y,this.z)}},{key:"createMesh",value:function(){this.geometry=new this.THREE.SphereGeometry(this.size,24,24,0,2*Math.PI,0,Math.PI/2),this.material=new this.THREE.MeshBasicMaterial({color:16777215}),this.mesh=new this.THREE.Mesh(this.geometry,this.material),this.mesh.position.copy(new this.THREE.Vector3(this.x,this.y,this.z)),this.mesh.rotation.x=this.rotx,this.mesh.rotation.y=this.roty,this.mesh.rotation.z=this.rotz,this.group=new this.THREE.Group,this.group.add(this.mesh)}},{key:"getMesh",value:function(){return this.group}},{key:"loop",value:function(e){}},{key:"setNeighbors",value:function(e){this.neighbors=Object(p.a)(e)}},{key:"getNeighbors",value:function(){return this.neighbors}},{key:"addNeighbor",value:function(e){this.neighbors.push(e)}},{key:"removeNeighbor",value:function(e){var t=this.neighbors.indexOf(e);-1!==t&&this.neighbors.splice(t,1)}},{key:"receiveMessage",value:function(e){}}]),e}(),y=i(9),k=i(19),w=i(67),S=(i(47),i(48),i(49),i(50),i(51),i(52),i(53),i(54),i(55),i(27),"Idle"),E="ImAlive",C="ImDead",A="Resurrect",T=function(e){Object(u.a)(i,e);var t=Object(g.a)(i);function i(e,s,a,n,r,o,l,c){var u,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,b=arguments.length>11?arguments[11]:void 0,v=arguments.length>12?arguments[12]:void 0;return Object(h.a)(this,i),(u=t.call(this,e,s,a,n,r,o,l,c,g,m,d)).debugSim=!1,u.debugNetwork=!1,u.lastStateSend=0,u.lastCycle=0,u.neighborState=new Map,u.params=b,u.setAlive(v),u.state.lastCycle=0,u.state.state=S,u.state.batch=0,u.state.aliveCount=0,u}return Object(l.a)(i,[{key:"setAlive",value:function(e){this.state.alive=e,e?this.material.color.setHex(255):this.material.color.setHex(2236962)}},{key:"isAlive",value:function(){return this.state.alive}},{key:"loop",value:function(e){var t=this;if(e>this.lastStateSend+this.params.stateSendTime){this.lastStateSend=e;var i={command:this.state.alive?E:C};this.debugSim&&0===this.id&&console.log("Sending state: "+this.state.alive+" to neighbors: "+this.neighbors.length);for(var s=0;s<this.neighbors.length;s++)this.radio.sendMessage(this.id,this.neighbors[s],i)}if(this.debugSim&&0===this.id&&console.log("Check cycle.  time: "+e+" next: "+(this.lastCycle+this.params.cycleTime)+" lastCycle: "+this.lastCycle+" cycleTime: "+this.params.cycleTime),e>this.lastCycle+this.params.cycleTime){this.debugSim&&0===this.id&&console.log("Cycle done.  Updating state.  neighbors: "+this.neighborState.size),this.lastCycle=e;var a=0;if(this.neighborState.forEach((function(e,i){t.debugSim&&0===t.id&&console.log(e,i),e&&a++})),this.debugSim&&0===this.id&&console.log("Agent: "+this.id+" aliveN: "+a),!0!==this.state.alive||2!==a&&3!==a)if(!1===this.state.alive){if(3===a)this.setAlive(!0);else if(Math.random()<this.params.spontaneousGeneration&&(this.setAlive(!0),Math.random()<this.params.resurrectionChance))for(var n=0;n<this.neighbors.length;n++){var r={command:A};this.radio.sendMessage(this.id,this.neighbors[n],r)}}else this.setAlive(!1);else this.setAlive(!0)}}},{key:"receiveMessage",value:function(e){switch(this.debugNetwork&&0===this.id&&console.log("Agent: "+this.id+" recv: "+JSON.stringify(e)),e.msg.command){case A:Math.random()<this.params.resurrectionChance&&this.setAlive(!0);break;case E:this.neighborState.set(e.from,!0);break;case C:this.neighborState.set(e.from,!1)}}},{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement("h1",null,"Game of Life"))}}]),i}(f);function N(e){var t=Object(s.useState)(e.startPattern),i=Object(v.a)(t,2),n=i[0],r=i[1],o=Object(s.useState)(e.size),h=Object(v.a)(o,2),l=h[0],c=h[1],u=Object(s.useState)(e.cycleTime),g=Object(v.a)(u,2),m=g[0],d=g[1],b=Object(s.useState)(e.spontaneousGeneration),p=Object(v.a)(b,2),f=p[0],S=p[1],E=Object(s.useState)(e.resurrectionChance),C=Object(v.a)(E,2),A=C[0],T=C[1];return a.a.createElement("div",{style:{width:"512px",border:"1px solid black",padding:"8px"}},a.a.createElement("h1",null,"Game of Life - Agent Control"),a.a.createElement("form",{onSubmit:function(t){return t&&t.preventDefault(),e.paramsChangedAction({startPattern:n,size:l,cycleTime:m,spontaneousGeneration:f,resurrectionChance:A}),null}},a.a.createElement(w.a,{style:{width:"100%",height:"56px",margin:"auto",display:"block",marginTop:"24px"},label:"Start Pattern",options:["toad","beacon","blinker","random","corners","blank","quadpole","pulsar","test"],value:n,onChange:function(e){return r(e.target.value)}}),a.a.createElement(k.a,{style:{width:"100%",height:"56px",margin:"auto",display:"block",marginTop:"24px"},label:"Size",required:!0,value:l,onChange:function(e){return c(parseInt(e.target.value))}}),a.a.createElement(k.a,{style:{width:"100%",height:"56px",margin:"auto",display:"block",marginTop:"24px"},label:"CycleTime",required:!0,value:m,onChange:function(e){return d(parseInt(e.target.value))}}),a.a.createElement(k.a,{style:{width:"100%",height:"56px",margin:"auto",display:"block",marginTop:"24px"},label:"Spontaneous Generation",required:!0,value:f,onChange:function(e){return S(e.target.value)}}),a.a.createElement(k.a,{style:{width:"100%",height:"56px",margin:"auto",display:"block",marginTop:"24px"},label:"Resurrection Chance",required:!0,value:A,onChange:function(e){return T(e.target.value)}}),a.a.createElement(y.a,{style:{width:"100%"},type:"submit",label:"Update"})))}i(32);var P=Object(s.memo)((function(e){return a.a.createElement("div",{style:{border:"1px solid black",padding:"8px"}},a.a.createElement("h1",null,"Simulation Control"),a.a.createElement("div",{style:{width:"100px",margin:"auto"}},a.a.createElement("b",null,"time: ",e.time)),a.a.createElement(y.a,{label:"Play",onClick:e.playAction}),a.a.createElement(y.a,{label:"Pause",onClick:e.pauseAction}),a.a.createElement(y.a,{label:"Step",onClick:e.stepAction}),a.a.createElement(y.a,{label:"Reset",onClick:e.resetAction}))}));var O=Object(s.memo)((function(e){return a.a.createElement("div",{style:{border:"1px solid black",padding:"8px"}},a.a.createElement("h1",null,"Camera Control"),a.a.createElement(y.a,{label:"Reset",onClick:e.resetAction}))})),M={height:512,maxWidth:1024},x=0,j=new m.Clock,z=function(e){Object(u.a)(i,e);var t=Object(g.a)(i);function i(){var e;Object(h.a)(this,i);for(var s=arguments.length,a=new Array(s),n=0;n<s;n++)a[n]=arguments[n];return(e=t.call.apply(t,[this].concat(a))).state={},e.debugNetwork=!1,e.debugNeighbors=!1,e.showNeighborsFor=-1,e.messages=[],e.simPaused=!0,e.pauseTime=Number.MAX_SAFE_INTEGER,e.time=0,e.lastLoopTime=(new Date).getTime(),e.agentParams={startPattern:"test",size:10,cycleTime:400,stateSendTime:50,spontaneousGeneration:0,resurrectionChance:0},e.worldSetup=function(){e.world=new b},e.agentSetup=function(t){var i,s=0,a=!1,n=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,0,0,0,0,0],[0,0,0,1,1,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,0],[0,0,0,0,0,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]];if("random"===t.startPattern)a=!0;else switch(t.startPattern){case"quadpole":i=[[0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,0,0],[0,1,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,0,1,0,0],[0,0,0,0,0,0,1,1,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]];break;case"blank":i=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]];break;case"test":i=n;break;case"corners":i=[[1,1,0,0,0,0,0,0,1,1],[1,0,0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,1],[1,1,0,0,0,0,0,0,1,1]];break;case"toad":i=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,0,0,0],[0,0,0,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]];break;case"beacon":i=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,0,0,0,0,0],[0,0,0,1,1,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,0],[0,0,0,0,0,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]];break;case"blinker":i=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]];break;case"pulsar":i=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0],[0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0],[0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0],[0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,0],[0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0],[0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0],[0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];break;default:console.log("Unknown pattern"),i=n}var r=t.size;r<i.length&&(r=i.length),e.agents=[];for(var o=0;o<r;o++)for(var h=0;h<r;h++){var l=!0,u=h,g=o;a?l=Math.random()<.4:(u=h,g=r-o-1,l=1===i[o][h]);var d=new T(m,Object(c.a)(e),s++,e.world,.1,u-r/2,g-r/2,0,Math.PI/2,0,0,t,l);e.agents[o*r+h]=d}},e.sceneSetup=function(){var t=e.el.clientWidth,i=e.el.clientHeight;e.scene=new m.Scene,e.camera=new m.PerspectiveCamera(75,t/i,.1,1e3),e.camera.position.z=10,e.controls=new d.a(e.camera,e.el),e.renderer=new m.WebGLRenderer,e.renderer.setSize(t,i),e.el.appendChild(e.renderer.domElement)},e.addCustomSceneObjects=function(){for(var t=0;t<e.agents.length;t++)e.scene.add(e.agents[t].getMesh());e.calcAgentNeighbors(8);var i=[];i[0]=new m.PointLight(16777215,1,0),i[1]=new m.PointLight(16777215,1,0),i[2]=new m.PointLight(16777215,1,0),i[0].position.set(0,200,0),i[1].position.set(100,200,100),i[2].position.set(-100,-200,-100)},e.startAnimationLoop=function(){e.requestID=window.requestAnimationFrame(e.startAnimationLoop);var t=(new Date).getTime();if(!e.simPaused){e.time+=t-e.lastLoopTime,e.setState({time:e.time});for(var i=[],s=0;s<e.messages.length;s++)e.messages[s].time<e.time&&(e.debugNetwork&&console.log("Routing message: "+JSON.stringify(e.messages[s])),"undefined"===typeof e.messages[s].to?console.log("Invalid message: "+JSON.stringify(e.messages[s])):e.agents[e.messages[s].to].receiveMessage(e.messages[s]),i.push(s));for(var a=0;a<i.length;a++)e.messages.splice(i[a]-a,1);for(var n=0;n<e.agents.length;n++)e.agents[n].loop(e.time);if(e.time>e.pauseTime)return e.simPaused=!0,e.renderer.render(e.scene,e.camera),void(e.pauseTime=Number.MAX_SAFE_INTEGER)}e.lastLoopTime=t,(x+=j.getDelta())<1/30||(e.renderer.render(e.scene,e.camera),x%=1/30)},e.handleWindowResize=function(){var t=e.el.clientWidth,i=e.el.clientHeight;e.renderer.setSize(t,i),e.camera.aspect=t/i,e.camera.updateProjectionMatrix()},e}return Object(l.a)(i,[{key:"componentDidMount",value:function(){this.worldSetup(),this.agentSetup(this.agentParams),this.sceneSetup(),this.addCustomSceneObjects(),this.startAnimationLoop(),window.addEventListener("resize",this.handleWindowResize),this.setState({time:0}),this.renderer.render(this.scene,this.camera)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleWindowResize),window.cancelAnimationFrame(this.requestID),this.controls.dispose()}},{key:"calcAgentNeighbors",value:function(e){this.debugNeighbors&&console.log("Calculating neighbors");for(var t=0;t<this.agents.length;t++){this.debugNeighbors&&console.log("Agent: "+t);for(var i=[],s=this.agents[t].getPosition(),a=0;a<this.agents.length;a++)if(a!==t){var n=this.agents[a].getPosition().distanceToSquared(s);i.push({dist:n,agentIdx:a})}i.sort((function(e,t){return e.dist-t.dist})),this.debugNeighbors&&console.log(JSON.stringify(i));for(var r=[],o=Math.min(e,i.length),h=0;h<o;h++)r[h]=i[h].agentIdx;this.debugNeighbors&&console.log(JSON.stringify(r)),this.agents[t].setNeighbors(r)}if(-1!==this.showNeighborsFor)for(var l=this.agents[this.showNeighborsFor].getNeighbors(),c=0;c<l.length;c++)this.agents[l[c]].setMarked(!0)}},{key:"sleep",value:function(e){var t=Date.now(),i=null;do{i=Date.now()}while(i-t<e)}},{key:"sendMessage",value:function(e,t,i){if(this.debugNetwork&&console.log("Send message. from: "+e+" to: "+t+" msg: "+JSON.stringify(i)),"undefined"===typeof e)throw new Error("From is required");if("undefined"===typeof t)throw new Error("To is required");this.messages.push({from:e,to:t,msg:i,time:this.time+0*Math.random()})}},{key:"handleSimPause",value:function(){this.simPaused=!0}},{key:"handleSimPlay",value:function(){this.simPaused=!1,this.lastLoopTime=(new Date).getTime()}},{key:"handleSimStep",value:function(){this.simPaused=!1,this.lastLoopTime=(new Date).getTime(),this.pauseTime=this.time+this.agentParams.cycleTime}},{key:"handleSimReset",value:function(){for(this.simPaused=!0,this.time=0,this.setState({time:this.time}),this.lastLoopTime=(new Date).getTime(),this.messages=[];this.scene.children.length>0;)this.scene.remove(this.scene.children[0]);this.agentSetup(this.agentParams),this.addCustomSceneObjects()}},{key:"handleCameraReset",value:function(){this.controls.reset()}},{key:"handleAgentParamsChanged",value:function(e){console.log("Params changed: "+JSON.stringify(e)),this.agentParams=Object(o.a)(Object(o.a)({},this.agentParams),e),this.handleSimReset()}},{key:"markNeighbors",value:function(e){for(var t=0;t<this.agents.length;t++)this.agents[t].setMarked(!1);for(var i=this.agents[e].getNeighbors(),s=0;s<i.length;s++)this.agents[i[s]].setMarked(!this.agents[i[s]].getMarked())}},{key:"showAliveCount",value:function(e){console.log("Agent: "+e);for(var t=this.agents[e].getNeighbors(),i=0,s=0;s<t.length;s++)console.log("neighbor: "+t[s]+" alive: "+this.agents[t[s]].isAlive()),this.agents[t[s]].isAlive()&&i++;console.log("aliveCount: "+i)}},{key:"handleKeyPressed",value:function(e){switch(e.key){case"0":this.markNeighbors(90),this.showAliveCount(90);break;case"1":this.markNeighbors(91),this.showAliveCount(91);break;case"2":this.markNeighbors(92),this.showAliveCount(92);break;case"3":this.markNeighbors(93),this.showAliveCount(93);break;case"4":this.markNeighbors(94),this.showAliveCount(94);break;case"5":this.markNeighbors(95),this.showAliveCount(95);break;case"6":this.markNeighbors(96),this.showAliveCount(96);break;case"7":this.markNeighbors(97),this.showAliveCount(97);break;case"8":this.markNeighbors(98),this.showAliveCount(98);break;case"9":this.markNeighbors(99),this.showAliveCount(99);break;case"s":this.handleSimStep();break;case"c":for(var t=0;t<this.agents.length;t++)this.agents[t].setMarked(!1)}}},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement("div",{style:M,ref:function(t){return e.el=t},onKeyPress:function(t){return e.handleKeyPressed(t)},autoFocus:!0}),a.a.createElement("div",{style:{display:"flex"}},a.a.createElement("div",null,a.a.createElement(P,{time:this.state.time,resetAction:function(t){return e.handleSimReset()},pauseAction:function(t){return e.handleSimPause()},playAction:function(t){return e.handleSimPlay()},stepAction:function(t){return e.handleSimStep()}}),a.a.createElement(O,{resetAction:function(t){return e.handleCameraReset()}})),a.a.createElement(N,Object.assign({},this.agentParams,{paramsChangedAction:function(t,i){return e.handleAgentParamsChanged(t,i)}}))))}}]),i}(s.Component),R=Object(s.memo)(z);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(R,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[41,1,2]]]);
//# sourceMappingURL=main.efdf5e02.chunk.js.map