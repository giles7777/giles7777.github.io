{"ast":null,"code":"import { __assign, __read, __rest } from \"tslib\";\nimport { useCallback, useEffect, useState, useRef } from 'react';\nimport { useFoundation, closest, emptyClientRect, raf } from '@rmwc/base';\nimport { MDCMenuSurfaceFoundation, util } from '@material/menu-surface';\nvar ANCHOR_CORNER_MAP = {\n  bottomEnd: 'BOTTOM_END',\n  bottomLeft: 'BOTTOM_LEFT',\n  bottomRight: 'BOTTOM_RIGHT',\n  bottomStart: 'BOTTOM_START',\n  topEnd: 'TOP_END',\n  topLeft: 'TOP_LEFT',\n  topRight: 'TOP_RIGHT',\n  topStart: 'TOP_START'\n};\n\nvar getAnchorCornerFromProp = function getAnchorCornerFromProp(anchorCorner) {\n  return MDCMenuSurfaceFoundation.Corner[ANCHOR_CORNER_MAP[anchorCorner]];\n};\n\nexport var useMenuSurfaceFoundation = function useMenuSurfaceFoundation(props) {\n  var _a = __read(useState(props.open), 2),\n      open = _a[0],\n      _setOpen = _a[1];\n\n  var firstFocusableElementRef = useRef(null);\n  var previousFocusRef = useRef(null);\n  var anchorElementRef = useRef(null);\n  var timerIdRef = useRef(null);\n\n  var _b = useFoundation({\n    props: props,\n    elements: {\n      rootEl: true\n    },\n    api: function api(_a) {\n      var foundation = _a.foundation,\n          rootEl = _a.rootEl;\n      return {\n        hoistMenuToBody: function hoistMenuToBody() {// this is controlled by the renderToPortal prop\n        },\n        setAnchorCorner: function setAnchorCorner(corner) {\n          return foundation.setAnchorCorner(corner);\n        },\n        setAnchorElement: function setAnchorElement(element) {\n          return anchorElementRef.current = element;\n        },\n        setOpen: function setOpen(open) {\n          return _setOpen(open);\n        },\n        getSurfaceElement: function getSurfaceElement() {\n          return rootEl.ref;\n        }\n      };\n    },\n    foundation: function foundation(_a) {\n      var rootEl = _a.rootEl,\n          getProps = _a.getProps,\n          emit = _a.emit;\n\n      var handleBodyClick = function handleBodyClick(evt) {\n        _foundation.handleBodyClick(evt);\n      };\n\n      var registerBodyClickListener = function registerBodyClickListener() {\n        /**\n         * Corrects issue on mobile devices that don't support fast click\n         * Causing the menu to close as soon as its open\n         **/\n        setTimeout(function () {\n          document.body.addEventListener('click', handleBodyClick);\n          document.body.addEventListener('touchstart', handleBodyClick);\n        }, 150);\n      };\n\n      var deregisterBodyClickListener = function deregisterBodyClickListener() {\n        document.body.removeEventListener('click', handleBodyClick);\n        document.body.removeEventListener('touchstart', handleBodyClick);\n      };\n\n      var getFocusAdapterMethods = function getFocusAdapterMethods() {\n        return {\n          isFocused: function isFocused() {\n            return document.activeElement === rootEl.ref;\n          },\n          saveFocus: function saveFocus() {\n            previousFocusRef.current = document.activeElement;\n          },\n          restoreFocus: function restoreFocus() {\n            if (rootEl.ref && rootEl.ref.contains(document.activeElement)) {\n              if (previousFocusRef.current && previousFocusRef.current.focus) {\n                previousFocusRef.current.focus();\n              }\n            }\n          },\n          isFirstElementFocused: function isFirstElementFocused() {\n            return !!firstFocusableElementRef.current && firstFocusableElementRef.current === document.activeElement;\n          },\n          isLastElementFocused: function isLastElementFocused() {\n            return !!firstFocusableElementRef.current && firstFocusableElementRef.current === document.activeElement;\n          },\n          focusFirstElement: function focusFirstElement() {\n            return !!firstFocusableElementRef.current && firstFocusableElementRef.current.focus && firstFocusableElementRef.current.focus();\n          },\n          focusLastElement: function focusLastElement() {\n            return !!firstFocusableElementRef.current && firstFocusableElementRef.current.focus && firstFocusableElementRef.current.focus();\n          }\n        };\n      };\n\n      var getDimensionAdapterMethods = function getDimensionAdapterMethods() {\n        return {\n          getInnerDimensions: function getInnerDimensions() {\n            return {\n              width: rootEl.ref ? rootEl.ref.offsetWidth : 0,\n              height: rootEl.ref ? rootEl.ref.offsetHeight : 0\n            };\n          },\n          getAnchorDimensions: function getAnchorDimensions() {\n            var _a;\n\n            return ((_a = anchorElementRef.current) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect()) || emptyClientRect;\n          },\n          getWindowDimensions: function getWindowDimensions() {\n            return {\n              width: window.innerWidth,\n              height: window.innerHeight\n            };\n          },\n          getBodyDimensions: function getBodyDimensions() {\n            return {\n              width: document.body.clientWidth,\n              height: document.body.clientHeight\n            };\n          },\n          getWindowScroll: function getWindowScroll() {\n            return {\n              x: window.pageXOffset,\n              y: window.pageYOffset\n            };\n          },\n          setPosition: function setPosition(position) {\n            rootEl.setStyle('left', position.left !== undefined ? position.left : null);\n            rootEl.setStyle('right', position.right !== undefined ? position.right : null);\n            rootEl.setStyle('top', position.top !== undefined ? position.top : null);\n            rootEl.setStyle('bottom', position.bottom !== undefined ? position.bottom : null);\n          },\n          setMaxHeight: function setMaxHeight(height) {\n            rootEl.setStyle('maxHeight', height);\n          }\n        };\n      };\n\n      var f = new MDCMenuSurfaceFoundation(__assign(__assign({\n        addClass: function addClass(className) {\n          rootEl.addClass(className);\n        },\n        removeClass: function removeClass(className) {\n          rootEl.removeClass(className);\n        },\n        hasClass: function hasClass(className) {\n          return className === 'mdc-menu-surface' ? true : rootEl.hasClass(className);\n        },\n        hasAnchor: function hasAnchor() {\n          return !!anchorElementRef.current;\n        },\n        notifyClose: function notifyClose() {\n          deregisterBodyClickListener();\n\n          _setOpen(false);\n        },\n        notifyOpen: function notifyOpen() {\n          emit('onOpen', {});\n          registerBodyClickListener();\n        },\n        isElementInContainer: function isElementInContainer(el) {\n          return rootEl.ref === el || !!rootEl.ref && rootEl.ref.contains(el);\n        },\n        isRtl: function isRtl() {\n          return !!rootEl.ref && getComputedStyle(rootEl.ref).getPropertyValue('direction') === 'rtl';\n        },\n        setTransformOrigin: function setTransformOrigin(origin) {\n          rootEl.setStyle(util.getTransformPropertyName(window) + \"-origin\", origin);\n        }\n      }, getFocusAdapterMethods()), getDimensionAdapterMethods())); // Fixes a very annoying issue where the menu isn't stateful\n      // this allows us to keep the menu open based on its controlled prop.\n\n      var existingClose = f.close.bind(f);\n\n      var newClose = function newClose(skipRestoreFocus) {\n        if (skipRestoreFocus === void 0) {\n          skipRestoreFocus = false;\n        }\n\n        emit('onClose', {});\n        timerIdRef.current = window.setTimeout(function () {\n          if (!getProps().open) {\n            existingClose(skipRestoreFocus);\n          }\n        });\n      };\n\n      f.close = newClose; // Didn't have another way to hook into the destroy function...\n\n      var existingDestroy = f.destroy.bind(f);\n\n      f.destroy = function () {\n        deregisterBodyClickListener();\n        existingDestroy();\n      };\n\n      return f;\n    }\n  }),\n      _foundation = _b.foundation,\n      elements = __rest(_b, [\"foundation\"]);\n\n  var rootEl = elements.rootEl;\n  var handleKeydown = useCallback(function (evt) {\n    var _a;\n\n    (_a = props.onKeyDown) === null || _a === void 0 ? void 0 : _a.call(props, evt);\n\n    _foundation.handleKeydown(evt);\n  }, [props.onKeyDown, _foundation]);\n  rootEl.setProp('onKeyDown', handleKeydown, true); // fixed\n\n  useEffect(function () {\n    _foundation.setFixedPosition(!!props.fixed);\n  }, [props.fixed, _foundation]); // on mount\n\n  useEffect(function () {\n    var el = rootEl.ref;\n\n    if (el) {\n      var anchor = closest(el, \".\" + MDCMenuSurfaceFoundation.cssClasses.ANCHOR);\n      anchor && (anchorElementRef.current = anchor);\n    }\n  }, [rootEl.ref]); // renderToPortal\n\n  useEffect(function () {\n    props.renderToPortal ? _foundation.setIsHoisted(true) : _foundation.setIsHoisted(false);\n\n    var autoPosition = function autoPosition() {\n      try {\n        // silence this, it blows up loudly occasionally\n        // @ts-ignore unsafe private variable access\n        _foundation.autoPosition_();\n      } catch (err) {}\n    }; // wait an extra frame so that the element is actually\n    // done being hoisted and painting. Fixes Issue #453\n\n\n    var handler = props.renderToPortal ? autoPosition : function () {};\n    raf(function () {\n      _foundation.isOpen() && autoPosition();\n    }); // fix positioning on window resize when renderToPortal is true\n\n    window.addEventListener('resize', handler);\n    return function () {\n      window.removeEventListener('resize', handler);\n    };\n  }, [props.renderToPortal, _foundation]); // anchorCorner\n\n  useEffect(function () {\n    var anchorCorner = props.anchorCorner && getAnchorCornerFromProp(props.anchorCorner);\n\n    if (anchorCorner !== undefined) {\n      _foundation.setAnchorCorner(anchorCorner); // @ts-ignore unsafe private variable reference\n\n\n      _foundation.dimensions_ = _foundation.adapter_.getInnerDimensions(); // @ts-ignore unsafe private variable reference\n\n      _foundation.autoPosition_();\n    }\n  }, [props.anchorCorner, _foundation]); // open\n\n  useEffect(function () {\n    if (open) {\n      var focusableElements = rootEl.ref ? rootEl.ref.querySelectorAll(MDCMenuSurfaceFoundation.strings.FOCUSABLE_ELEMENTS) : [];\n      firstFocusableElementRef.current = focusableElements.length > 0 ? focusableElements[0] : null;\n\n      _foundation.open();\n    } else if (_foundation.isOpen()) {\n      _foundation.close();\n    }\n  }, [open, _foundation, rootEl.ref]);\n  useEffect(function () {\n    _setOpen(!!props.open);\n  }, [props.open]); // cleanup\n\n  useEffect(function () {\n    return function () {\n      timerIdRef.current && window.clearTimeout(timerIdRef.current);\n    };\n  }, []);\n  return __assign({}, elements);\n};","map":{"version":3,"sources":["C:/cygwin64/home/giles/projs/personal/getalife/website/giles7777.github.io/node_modules/@rmwc/menu/next/menu-surface/foundation.js"],"names":["__assign","__read","__rest","useCallback","useEffect","useState","useRef","useFoundation","closest","emptyClientRect","raf","MDCMenuSurfaceFoundation","util","ANCHOR_CORNER_MAP","bottomEnd","bottomLeft","bottomRight","bottomStart","topEnd","topLeft","topRight","topStart","getAnchorCornerFromProp","anchorCorner","Corner","useMenuSurfaceFoundation","props","_a","open","setOpen","firstFocusableElementRef","previousFocusRef","anchorElementRef","timerIdRef","_b","elements","rootEl","api","foundation","hoistMenuToBody","setAnchorCorner","corner","setAnchorElement","element","current","getSurfaceElement","ref","getProps","emit","handleBodyClick","evt","registerBodyClickListener","setTimeout","document","body","addEventListener","deregisterBodyClickListener","removeEventListener","getFocusAdapterMethods","isFocused","activeElement","saveFocus","restoreFocus","contains","focus","isFirstElementFocused","isLastElementFocused","focusFirstElement","focusLastElement","getDimensionAdapterMethods","getInnerDimensions","width","offsetWidth","height","offsetHeight","getAnchorDimensions","getBoundingClientRect","getWindowDimensions","window","innerWidth","innerHeight","getBodyDimensions","clientWidth","clientHeight","getWindowScroll","x","pageXOffset","y","pageYOffset","setPosition","position","setStyle","left","undefined","right","top","bottom","setMaxHeight","f","addClass","className","removeClass","hasClass","hasAnchor","notifyClose","notifyOpen","isElementInContainer","el","isRtl","getComputedStyle","getPropertyValue","setTransformOrigin","origin","getTransformPropertyName","existingClose","close","bind","newClose","skipRestoreFocus","existingDestroy","destroy","handleKeydown","onKeyDown","call","setProp","setFixedPosition","fixed","anchor","cssClasses","ANCHOR","renderToPortal","setIsHoisted","autoPosition","autoPosition_","err","handler","isOpen","dimensions_","adapter_","focusableElements","querySelectorAll","strings","FOCUSABLE_ELEMENTS","length","clearTimeout"],"mappings":"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","sourcesContent":["import { __assign, __read, __rest } from \"tslib\";\nimport { useCallback, useEffect, useState, useRef } from 'react';\nimport { useFoundation, closest, emptyClientRect, raf } from '@rmwc/base';\nimport { MDCMenuSurfaceFoundation, util } from '@material/menu-surface';\nvar ANCHOR_CORNER_MAP = {\n    bottomEnd: 'BOTTOM_END',\n    bottomLeft: 'BOTTOM_LEFT',\n    bottomRight: 'BOTTOM_RIGHT',\n    bottomStart: 'BOTTOM_START',\n    topEnd: 'TOP_END',\n    topLeft: 'TOP_LEFT',\n    topRight: 'TOP_RIGHT',\n    topStart: 'TOP_START'\n};\nvar getAnchorCornerFromProp = function (anchorCorner) { return MDCMenuSurfaceFoundation.Corner[ANCHOR_CORNER_MAP[anchorCorner]]; };\nexport var useMenuSurfaceFoundation = function (props) {\n    var _a = __read(useState(props.open), 2), open = _a[0], setOpen = _a[1];\n    var firstFocusableElementRef = useRef(null);\n    var previousFocusRef = useRef(null);\n    var anchorElementRef = useRef(null);\n    var timerIdRef = useRef(null);\n    var _b = useFoundation({\n        props: props,\n        elements: { rootEl: true },\n        api: function (_a) {\n            var foundation = _a.foundation, rootEl = _a.rootEl;\n            return {\n                hoistMenuToBody: function () {\n                    // this is controlled by the renderToPortal prop\n                },\n                setAnchorCorner: function (corner) { return foundation.setAnchorCorner(corner); },\n                setAnchorElement: function (element) {\n                    return (anchorElementRef.current = element);\n                },\n                setOpen: function (open) { return setOpen(open); },\n                getSurfaceElement: function () { return rootEl.ref; }\n            };\n        },\n        foundation: function (_a) {\n            var rootEl = _a.rootEl, getProps = _a.getProps, emit = _a.emit;\n            var handleBodyClick = function (evt) {\n                foundation.handleBodyClick(evt);\n            };\n            var registerBodyClickListener = function () {\n                /**\n                 * Corrects issue on mobile devices that don't support fast click\n                 * Causing the menu to close as soon as its open\n                 **/\n                setTimeout(function () {\n                    document.body.addEventListener('click', handleBodyClick);\n                    document.body.addEventListener('touchstart', handleBodyClick);\n                }, 150);\n            };\n            var deregisterBodyClickListener = function () {\n                document.body.removeEventListener('click', handleBodyClick);\n                document.body.removeEventListener('touchstart', handleBodyClick);\n            };\n            var getFocusAdapterMethods = function () {\n                return {\n                    isFocused: function () { return document.activeElement === rootEl.ref; },\n                    saveFocus: function () {\n                        previousFocusRef.current = document.activeElement;\n                    },\n                    restoreFocus: function () {\n                        if (rootEl.ref && rootEl.ref.contains(document.activeElement)) {\n                            if (previousFocusRef.current && previousFocusRef.current.focus) {\n                                previousFocusRef.current.focus();\n                            }\n                        }\n                    },\n                    isFirstElementFocused: function () {\n                        return !!firstFocusableElementRef.current &&\n                            firstFocusableElementRef.current === document.activeElement;\n                    },\n                    isLastElementFocused: function () {\n                        return !!firstFocusableElementRef.current &&\n                            firstFocusableElementRef.current === document.activeElement;\n                    },\n                    focusFirstElement: function () {\n                        return !!firstFocusableElementRef.current &&\n                            firstFocusableElementRef.current.focus &&\n                            firstFocusableElementRef.current.focus();\n                    },\n                    focusLastElement: function () {\n                        return !!firstFocusableElementRef.current &&\n                            firstFocusableElementRef.current.focus &&\n                            firstFocusableElementRef.current.focus();\n                    }\n                };\n            };\n            var getDimensionAdapterMethods = function () {\n                return {\n                    getInnerDimensions: function () {\n                        return {\n                            width: rootEl.ref ? rootEl.ref.offsetWidth : 0,\n                            height: rootEl.ref ? rootEl.ref.offsetHeight : 0\n                        };\n                    },\n                    getAnchorDimensions: function () {\n                        var _a;\n                        return (((_a = anchorElementRef.current) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect()) ||\n                            emptyClientRect);\n                    },\n                    getWindowDimensions: function () {\n                        return {\n                            width: window.innerWidth,\n                            height: window.innerHeight\n                        };\n                    },\n                    getBodyDimensions: function () {\n                        return {\n                            width: document.body.clientWidth,\n                            height: document.body.clientHeight\n                        };\n                    },\n                    getWindowScroll: function () {\n                        return { x: window.pageXOffset, y: window.pageYOffset };\n                    },\n                    setPosition: function (position) {\n                        rootEl.setStyle('left', position.left !== undefined ? position.left : null);\n                        rootEl.setStyle('right', position.right !== undefined ? position.right : null);\n                        rootEl.setStyle('top', position.top !== undefined ? position.top : null);\n                        rootEl.setStyle('bottom', position.bottom !== undefined ? position.bottom : null);\n                    },\n                    setMaxHeight: function (height) {\n                        rootEl.setStyle('maxHeight', height);\n                    }\n                };\n            };\n            var f = new MDCMenuSurfaceFoundation(__assign(__assign({ addClass: function (className) {\n                    rootEl.addClass(className);\n                }, removeClass: function (className) {\n                    rootEl.removeClass(className);\n                }, hasClass: function (className) {\n                    return className === 'mdc-menu-surface' ? true : rootEl.hasClass(className);\n                }, hasAnchor: function () { return !!anchorElementRef.current; }, notifyClose: function () {\n                    deregisterBodyClickListener();\n                    setOpen(false);\n                }, notifyOpen: function () {\n                    emit('onOpen', {});\n                    registerBodyClickListener();\n                }, isElementInContainer: function (el) {\n                    return rootEl.ref === el || (!!rootEl.ref && rootEl.ref.contains(el));\n                }, isRtl: function () {\n                    return !!rootEl.ref &&\n                        getComputedStyle(rootEl.ref).getPropertyValue('direction') === 'rtl';\n                }, setTransformOrigin: function (origin) {\n                    rootEl.setStyle(util.getTransformPropertyName(window) + \"-origin\", origin);\n                } }, getFocusAdapterMethods()), getDimensionAdapterMethods()));\n            // Fixes a very annoying issue where the menu isn't stateful\n            // this allows us to keep the menu open based on its controlled prop.\n            var existingClose = f.close.bind(f);\n            var newClose = function (skipRestoreFocus) {\n                if (skipRestoreFocus === void 0) { skipRestoreFocus = false; }\n                emit('onClose', {});\n                timerIdRef.current = window.setTimeout(function () {\n                    if (!getProps().open) {\n                        existingClose(skipRestoreFocus);\n                    }\n                });\n            };\n            f.close = newClose;\n            // Didn't have another way to hook into the destroy function...\n            var existingDestroy = f.destroy.bind(f);\n            f.destroy = function () {\n                deregisterBodyClickListener();\n                existingDestroy();\n            };\n            return f;\n        }\n    }), foundation = _b.foundation, elements = __rest(_b, [\"foundation\"]);\n    var rootEl = elements.rootEl;\n    var handleKeydown = useCallback(function (evt) {\n        var _a;\n        (_a = props.onKeyDown) === null || _a === void 0 ? void 0 : _a.call(props, evt);\n        foundation.handleKeydown(evt);\n    }, [props.onKeyDown, foundation]);\n    rootEl.setProp('onKeyDown', handleKeydown, true);\n    // fixed\n    useEffect(function () {\n        foundation.setFixedPosition(!!props.fixed);\n    }, [props.fixed, foundation]);\n    // on mount\n    useEffect(function () {\n        var el = rootEl.ref;\n        if (el) {\n            var anchor = closest(el, \".\" + MDCMenuSurfaceFoundation.cssClasses.ANCHOR);\n            anchor && (anchorElementRef.current = anchor);\n        }\n    }, [rootEl.ref]);\n    // renderToPortal\n    useEffect(function () {\n        props.renderToPortal\n            ? foundation.setIsHoisted(true)\n            : foundation.setIsHoisted(false);\n        var autoPosition = function () {\n            try {\n                // silence this, it blows up loudly occasionally\n                // @ts-ignore unsafe private variable access\n                foundation.autoPosition_();\n            }\n            catch (err) { }\n        };\n        // wait an extra frame so that the element is actually\n        // done being hoisted and painting. Fixes Issue #453\n        var handler = props.renderToPortal ? autoPosition : function () { };\n        raf(function () {\n            foundation.isOpen() && autoPosition();\n        });\n        // fix positioning on window resize when renderToPortal is true\n        window.addEventListener('resize', handler);\n        return function () {\n            window.removeEventListener('resize', handler);\n        };\n    }, [props.renderToPortal, foundation]);\n    // anchorCorner\n    useEffect(function () {\n        var anchorCorner = props.anchorCorner && getAnchorCornerFromProp(props.anchorCorner);\n        if (anchorCorner !== undefined) {\n            foundation.setAnchorCorner(anchorCorner);\n            // @ts-ignore unsafe private variable reference\n            foundation.dimensions_ = foundation.adapter_.getInnerDimensions();\n            // @ts-ignore unsafe private variable reference\n            foundation.autoPosition_();\n        }\n    }, [props.anchorCorner, foundation]);\n    // open\n    useEffect(function () {\n        if (open) {\n            var focusableElements = rootEl.ref\n                ? rootEl.ref.querySelectorAll(MDCMenuSurfaceFoundation.strings.FOCUSABLE_ELEMENTS)\n                : [];\n            firstFocusableElementRef.current =\n                focusableElements.length > 0 ? focusableElements[0] : null;\n            foundation.open();\n        }\n        else if (foundation.isOpen()) {\n            foundation.close();\n        }\n    }, [open, foundation, rootEl.ref]);\n    useEffect(function () {\n        setOpen(!!props.open);\n    }, [props.open]);\n    // cleanup\n    useEffect(function () {\n        return function () {\n            timerIdRef.current && window.clearTimeout(timerIdRef.current);\n        };\n    }, []);\n    return __assign({}, elements);\n};\n"]},"metadata":{},"sourceType":"module"}