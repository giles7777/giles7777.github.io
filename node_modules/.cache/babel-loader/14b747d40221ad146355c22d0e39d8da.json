{"ast":null,"code":"var _jsxFileName = \"C:\\\\cygwin64\\\\home\\\\giles\\\\projs\\\\personal\\\\getalife\\\\prototype\\\\src\\\\ConwayAgent.js\";\nimport React, { Component, memo, useEffect, useState } from \"react\";\nimport { Agent } from \"./Agent\";\nimport { Button } from \"@rmwc/button\";\nimport { TextField } from \"@rmwc/textfield\";\nimport { Select } from \"@rmwc/select\";\nimport '@material/textfield/dist/mdc.textfield.css';\nimport '@rmwc/select/select.css';\nimport '@material/select/dist/mdc.select.css';\nimport '@material/floating-label/dist/mdc.floating-label.css';\nimport '@material/notched-outline/dist/mdc.notched-outline.css';\nimport '@material/line-ripple/dist/mdc.line-ripple.css';\nimport '@material/list/dist/mdc.list.css';\nimport '@material/menu/dist/mdc.menu.css';\nimport '@material/menu-surface/dist/mdc.menu-surface.css';\nimport '@material/ripple/dist/mdc.ripple.css';\nconst States = {\n  Idle: \"Idle\",\n  Sensing: \"Sensing\"\n};\nconst Messages = {\n  AreYouAlive: \"AreYouAlive\",\n  ImAlive: \"ImAlive\",\n  ImDead: \"ImDead\",\n  Resurrect: \"Resurrect\"\n};\n/*\r\nAgent based on Conway's Game of Life\r\n */\n\nexport class ConwayAgent extends Agent {\n  constructor(context, radio, id, world, size, x, y, z, rotx = 0, roty = 0, rotz = 0, params, alive) {\n    super(context, radio, id, world, size, x, y, z, rotx, roty, rotz);\n    this.debugSim = false;\n    this.debugNetwork = false;\n    this.lastStateSend = 0;\n    this.lastCycle = 0;\n    this.neighborState = new Map();\n    this.params = params;\n    this.setAlive(alive);\n    this.state.lastCycle = 0;\n    this.state.state = States.Idle;\n    this.state.batch = 0;\n    this.state.aliveCount = 0;\n  }\n\n  setAlive(alive) {\n    this.state.alive = alive;\n\n    if (alive) {\n      this.material.color.setHex(0x0000FF);\n    } else {\n      this.material.color.setHex(0x222222);\n    }\n  }\n\n  isAlive() {\n    return this.state.alive;\n  }\n\n  loop(time) {\n    if (time > this.lastStateSend + this.params.stateSendTime) {\n      this.lastStateSend = time;\n      let msg = {\n        command: this.state.alive ? Messages.ImAlive : Messages.ImDead\n      };\n\n      if (this.debugSim && this.id === 0) {\n        console.log(\"Sending state: \" + this.state.alive + \" to neighbors: \" + this.neighbors.length); //console.log(JSON.stringify(msg));\n      }\n\n      for (let i = 0; i < this.neighbors.length; i++) {\n        this.radio.sendMessage(this.id, this.neighbors[i], msg);\n      }\n    }\n\n    if (this.debugSim && this.id === 0) console.log(\"Check cycle.  time: \" + time + \" next: \" + (this.lastCycle + this.params.cycleTime) + \" lastCycle: \" + this.lastCycle + \" cycleTime: \" + this.params.cycleTime);\n\n    if (time > this.lastCycle + this.params.cycleTime) {\n      if (this.debugSim && this.id === 0) {\n        console.log(\"Cycle done.  Updating state.  neighbors: \" + this.neighborState.size);\n      }\n\n      this.lastCycle = time;\n      let aliveCount = 0;\n      this.neighborState.forEach((k, v) => {\n        if (this.debugSim && this.id === 0) console.log(k, v);\n\n        if (k) {\n          aliveCount++;\n        }\n      });\n      /*\r\n      for(let [k,v] of this.neighborState) {\r\n        if (v === true) aliveCount++;\r\n        if (this.debugSim && this.id === 0) {\r\n          //console.log(\"Agent: \" + k + \" alive: \" + v);\r\n        }\r\n      }\r\n       */\n\n      if (this.debugSim && this.id === 0) {\n        console.log(\"Agent: \" + this.id + \" aliveN: \" + aliveCount);\n      }\n\n      if (this.state.alive === true && (aliveCount === 2 || aliveCount === 3)) {\n        this.setAlive(true);\n      } else if (this.state.alive === false) {\n        if (aliveCount === 3) {\n          this.setAlive(true);\n        } else {\n          if (Math.random() < this.params.spontaneousGeneration) {\n            //console.log(\"Spontanous Generate\");\n            this.setAlive(true);\n\n            if (Math.random() < this.params.resurrectionChance) {\n              //console.log(\"Awake my brothers!\");\n              // Resurrect your neighbors\n              for (let i = 0; i < this.neighbors.length; i++) {\n                let msg = {\n                  command: Messages.Resurrect\n                };\n                this.radio.sendMessage(this.id, this.neighbors[i], msg);\n              }\n            }\n          }\n        }\n      } else {\n        this.setAlive(false);\n      }\n    }\n  } // Receive a network message.  Contains from,to,msg properties\n\n\n  receiveMessage(wrapper) {\n    if (this.debugNetwork && this.id === 0) {\n      console.log(\"Agent: \" + this.id + \" recv: \" + JSON.stringify(wrapper));\n    }\n\n    let msg = wrapper.msg;\n\n    switch (msg.command) {\n      case Messages.Resurrect:\n        let r = Math.random(); //console.log(\"Got resurrect.  rolled: \" + r + \" vs: \" + this.params.resurrectionChance);\n\n        if (r < this.params.resurrectionChance) {\n          //console.log(\"Jesus!\");\n          this.setAlive(true);\n        }\n\n        break;\n\n      case Messages.ImAlive:\n        this.neighborState.set(wrapper.from, true);\n        break;\n\n      case Messages.ImDead:\n        this.neighborState.set(wrapper.from, false);\n        break;\n    }\n  }\n  /*\r\n    // Simulation methods\r\n    loop(time) {\r\n      if (this.state.state === States.Idle) {\r\n        //if (this.id === 0) console.log(\"time: \" + time + \" next: \" + (this.state.lastCycle + this.params.cycleTime));\r\n        if (time < this.state.lastCycle + this.params.cycleTime) return;\r\n          if (this.debugSim && this.id == 0) {\r\n          console.log(\"Start Sensing: \" + time);\r\n        }\r\n          this.state.state = States.Sensing;\r\n        this.state.startedSensing = time;\r\n        this.state.batch = this.state.batch + 1;\r\n        this.state.aliveCount = 0;\r\n          // Query our neighbors.\r\n        for(let i=0; i < this.neighbors.length; i++) {\r\n          let msg = {command:Messages.AreYouAlive, batch:this.state.batch};\r\n          this.radio.sendMessage(this.id, this.neighbors[i], msg);\r\n        }\r\n      } else if (this.state.state === States.Sensing) {\r\n        if (time > this.state.startedSensing + this.params.cycleTime) {\r\n          if (this.debugSim && this.id == 0) {\r\n            console.log(\"End Sensing: \" + time)\r\n          }\r\n          // We've collected as many answers as we are going to get\r\n          if (this.state.alive === true && (this.state.aliveCount === 2 || this.state.aliveCount === 3)) {\r\n            this.setAlive(true);\r\n          } else if (this.state.alive === false) {\r\n              if (this.state.aliveCount === 3) {\r\n              this.setAlive(true);\r\n            } else {\r\n              if (Math.random() < this.params.spontaneousGeneration) {\r\n                //console.log(\"Spontanous Generate\");\r\n                this.setAlive(true);\r\n                if (Math.random() < this.params.resurrectionChance) {\r\n                  //console.log(\"Awake my brothers!\");\r\n                  // Resurrect your neighbors\r\n                  for(let i=0; i < this.neighbors.length; i++) {\r\n                    let msg = {command:Messages.Resurrect};\r\n                    this.radio.sendMessage(this.id, this.neighbors[i], msg);\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          } else {\r\n            this.setAlive(false);\r\n          }\r\n            this.state.state = States.Idle;\r\n          this.state.lastCycle = time;\r\n          return;\r\n        }\r\n      }\r\n    }\r\n      // Receive a network message.  Contains from,to,msg properties\r\n    receiveMessage(wrapper) {\r\n      if (this.debugNetwork) {\r\n        console.log(\"Agent: \" + this.id + \" recv: \" + JSON.stringify(wrapper));\r\n      }\r\n        let msg = wrapper.msg;\r\n        if (msg.command === Messages.Resurrect) {\r\n        let r = Math.random();\r\n        //console.log(\"Got resurrect.  rolled: \" + r + \" vs: \" + this.params.resurrectionChance);\r\n        if (r < this.params.resurrectionChance) {\r\n          //console.log(\"Jesus!\");\r\n          this.setAlive(true);\r\n        }\r\n      }\r\n        if (this.state.state !== States.Sensing) {\r\n        if (this.debugNetwork) {\r\n          console.log(\"Agent: \" + this.id + \" ignored.  Not Sensing\");\r\n        }\r\n        // ignore\r\n        return;\r\n      }\r\n        switch(msg.command) {\r\n        case Messages.ImAlive:\r\n          if (msg.batch !== this.state.batch) {\r\n            // ignore old batch answer\r\n            return;\r\n          }\r\n            this.state.aliveCount++;\r\n          break;\r\n        case Messages.AreYouAlive:\r\n          if (this.state.alive === true) {\r\n            this.radio.sendMessage(this.id, wrapper.from, {command: Messages.ImAlive, batch: msg.batch})\r\n          }\r\n          // Do not send a message if dead to preserve bandwidth\r\n          break;\r\n      }\r\n    }\r\n  */\n\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 12\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 17\n      }\n    }, \"Game of Life\"));\n  }\n\n}\nexport function ConwayControl(props) {\n  const [startPattern, setStartPattern] = useState(props.startPattern);\n  const [size, setSize] = useState(props.size);\n  const [cycleTime, setCycleTime] = useState(props.cycleTime);\n  const [spontaneousGeneration, setSpontaneousGeneration] = useState(props.spontaneousGeneration);\n  const [resurrectionChance, setResurrectionChance] = useState(props.resurrectionChance);\n\n  const submit = evt => {\n    if (evt) evt.preventDefault();\n    props.paramsChangedAction({\n      startPattern: startPattern,\n      size: size,\n      cycleTime: cycleTime,\n      spontaneousGeneration: spontaneousGeneration,\n      resurrectionChance: resurrectionChance\n    });\n    return null;\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      width: \"512px\",\n      border: \"1px solid black\",\n      padding: \"8px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 277,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 282,\n      columnNumber: 7\n    }\n  }, \"Game of Life - Agent Control\"), /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: submit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Select, {\n    style: {\n      width: \"100%\",\n      height: \"56px\",\n      margin: \"auto\",\n      display: \"block\",\n      marginTop: \"24px\"\n    },\n    label: \"Start Pattern\",\n    options: [\"random\", \"corners\", \"blank\", \"quadpole\", \"test\"],\n    value: startPattern,\n    onChange: e => setStartPattern(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(TextField, {\n    style: {\n      width: \"100%\",\n      height: \"56px\",\n      margin: \"auto\",\n      display: \"block\",\n      marginTop: \"24px\"\n    },\n    label: \"Size\",\n    required: true,\n    value: size,\n    onChange: e => setSize(parseInt(e.target.value)),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 292,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(TextField, {\n    style: {\n      width: \"100%\",\n      height: \"56px\",\n      margin: \"auto\",\n      display: \"block\",\n      marginTop: \"24px\"\n    },\n    label: \"CycleTime\",\n    required: true,\n    value: cycleTime,\n    onChange: e => setCycleTime(parseInt(e.target.value)),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 299,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(TextField, {\n    style: {\n      width: \"100%\",\n      height: \"56px\",\n      margin: \"auto\",\n      display: \"block\",\n      marginTop: \"24px\"\n    },\n    label: \"Spontaneous Generation\",\n    required: true,\n    value: spontaneousGeneration,\n    onChange: e => setSpontaneousGeneration(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(TextField, {\n    style: {\n      width: \"100%\",\n      height: \"56px\",\n      margin: \"auto\",\n      display: \"block\",\n      marginTop: \"24px\"\n    },\n    label: \"Resurrection Chance\",\n    required: true,\n    value: resurrectionChance,\n    onChange: e => setResurrectionChance(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 313,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Button, {\n    style: {\n      width: \"100%\"\n    },\n    type: \"submit\",\n    label: \"Update\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 320,\n      columnNumber: 9\n    }\n  })));\n}","map":{"version":3,"sources":["C:/cygwin64/home/giles/projs/personal/getalife/prototype/src/ConwayAgent.js"],"names":["React","Component","memo","useEffect","useState","Agent","Button","TextField","Select","States","Idle","Sensing","Messages","AreYouAlive","ImAlive","ImDead","Resurrect","ConwayAgent","constructor","context","radio","id","world","size","x","y","z","rotx","roty","rotz","params","alive","debugSim","debugNetwork","lastStateSend","lastCycle","neighborState","Map","setAlive","state","batch","aliveCount","material","color","setHex","isAlive","loop","time","stateSendTime","msg","command","console","log","neighbors","length","i","sendMessage","cycleTime","forEach","k","v","Math","random","spontaneousGeneration","resurrectionChance","receiveMessage","wrapper","JSON","stringify","r","set","from","render","ConwayControl","props","startPattern","setStartPattern","setSize","setCycleTime","setSpontaneousGeneration","setResurrectionChance","submit","evt","preventDefault","paramsChangedAction","width","border","padding","height","margin","display","marginTop","e","target","value","parseInt"],"mappings":"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","sourcesContent":["import React, { Component, memo, useEffect, useState } from \"react\";\r\n\r\nimport {Agent} from \"./Agent\";\r\nimport {Button} from \"@rmwc/button\";\r\nimport {TextField} from \"@rmwc/textfield\"\r\nimport {Select} from \"@rmwc/select\"\r\n\r\nimport '@material/textfield/dist/mdc.textfield.css';\r\nimport '@rmwc/select/select.css';\r\nimport '@material/select/dist/mdc.select.css';\r\nimport '@material/floating-label/dist/mdc.floating-label.css';\r\nimport '@material/notched-outline/dist/mdc.notched-outline.css';\r\nimport '@material/line-ripple/dist/mdc.line-ripple.css';\r\nimport '@material/list/dist/mdc.list.css';\r\nimport '@material/menu/dist/mdc.menu.css';\r\nimport '@material/menu-surface/dist/mdc.menu-surface.css';\r\nimport '@material/ripple/dist/mdc.ripple.css';\r\n\r\nconst States = {Idle:\"Idle\",Sensing:\"Sensing\"};\r\nconst Messages = {AreYouAlive:\"AreYouAlive\",ImAlive:\"ImAlive\",ImDead:\"ImDead\",Resurrect:\"Resurrect\"};\r\n\r\n\r\n/*\r\nAgent based on Conway's Game of Life\r\n */\r\nexport class ConwayAgent extends Agent {\r\n  debugSim = false;\r\n  debugNetwork = false;\r\n  lastStateSend = 0;\r\n  lastCycle = 0;\r\n  neighborState = new Map();\r\n\r\n  constructor(context,radio,id,world,size,x,y,z,rotx=0,roty=0,rotz=0,params,alive) {\r\n    super(context,radio,id,world,size,x,y,z,rotx,roty,rotz);\r\n\r\n    this.params = params;\r\n    this.setAlive(alive);\r\n    this.state.lastCycle = 0;\r\n    this.state.state = States.Idle;\r\n    this.state.batch = 0;\r\n    this.state.aliveCount = 0;\r\n  }\r\n\r\n  setAlive(alive) {\r\n    this.state.alive = alive;\r\n\r\n    if (alive) {\r\n      this.material.color.setHex(0x0000FF);\r\n    } else {\r\n      this.material.color.setHex(0x222222);\r\n    }\r\n  }\r\n\r\n  isAlive() {\r\n    return this.state.alive;\r\n  }\r\n\r\n  loop(time) {\r\n    if (time > this.lastStateSend + this.params.stateSendTime) {\r\n      this.lastStateSend = time;\r\n      let msg = {command:this.state.alive ?Messages.ImAlive:Messages.ImDead};\r\n      if (this.debugSim && this.id === 0) {\r\n        console.log(\"Sending state: \" + this.state.alive + \" to neighbors: \" + this.neighbors.length);\r\n        //console.log(JSON.stringify(msg));\r\n      }\r\n      for(let i=0; i < this.neighbors.length; i++) {\r\n        this.radio.sendMessage(this.id, this.neighbors[i], msg);\r\n      }\r\n    }\r\n\r\n    if (this.debugSim && this.id === 0) console.log(\"Check cycle.  time: \" + time + \" next: \" + (this.lastCycle + this.params.cycleTime) + \" lastCycle: \" + this.lastCycle + \" cycleTime: \" + this.params.cycleTime);\r\n    if (time > this.lastCycle + this.params.cycleTime) {\r\n      if (this.debugSim && this.id === 0) {\r\n        console.log(\"Cycle done.  Updating state.  neighbors: \" + this.neighborState.size);\r\n      }\r\n      this.lastCycle = time;\r\n      let aliveCount = 0;\r\n      this.neighborState.forEach( (k,v) => {\r\n        if (this.debugSim && this.id === 0) console.log(k, v);\r\n        if (k) {\r\n          aliveCount++;\r\n        }\r\n      } );\r\n      /*\r\n      for(let [k,v] of this.neighborState) {\r\n        if (v === true) aliveCount++;\r\n        if (this.debugSim && this.id === 0) {\r\n          //console.log(\"Agent: \" + k + \" alive: \" + v);\r\n        }\r\n      }\r\n       */\r\n\r\n      if (this.debugSim && this.id === 0) {\r\n        console.log(\"Agent: \" + this.id + \" aliveN: \" + aliveCount);\r\n      }\r\n      if (this.state.alive === true && (aliveCount === 2 || aliveCount === 3)) {\r\n        this.setAlive(true);\r\n      } else if (this.state.alive === false) {\r\n\r\n        if (aliveCount === 3) {\r\n          this.setAlive(true);\r\n        } else {\r\n          if (Math.random() < this.params.spontaneousGeneration) {\r\n            //console.log(\"Spontanous Generate\");\r\n            this.setAlive(true);\r\n            if (Math.random() < this.params.resurrectionChance) {\r\n              //console.log(\"Awake my brothers!\");\r\n              // Resurrect your neighbors\r\n              for(let i=0; i < this.neighbors.length; i++) {\r\n                let msg = {command:Messages.Resurrect};\r\n                this.radio.sendMessage(this.id, this.neighbors[i], msg);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        this.setAlive(false);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Receive a network message.  Contains from,to,msg properties\r\n  receiveMessage(wrapper) {\r\n    if (this.debugNetwork && this.id === 0) {\r\n      console.log(\"Agent: \" + this.id + \" recv: \" + JSON.stringify(wrapper));\r\n    }\r\n\r\n    let msg = wrapper.msg;\r\n\r\n    switch(msg.command) {\r\n      case Messages.Resurrect:\r\n        let r = Math.random();\r\n        //console.log(\"Got resurrect.  rolled: \" + r + \" vs: \" + this.params.resurrectionChance);\r\n        if (r < this.params.resurrectionChance) {\r\n          //console.log(\"Jesus!\");\r\n          this.setAlive(true);\r\n        }\r\n        break;\r\n      case Messages.ImAlive:\r\n        this.neighborState.set(wrapper.from,true);\r\n        break;\r\n      case Messages.ImDead:\r\n        this.neighborState.set(wrapper.from,false);\r\n        break;\r\n    }\r\n  }\r\n\r\n  /*\r\n    // Simulation methods\r\n    loop(time) {\r\n      if (this.state.state === States.Idle) {\r\n        //if (this.id === 0) console.log(\"time: \" + time + \" next: \" + (this.state.lastCycle + this.params.cycleTime));\r\n        if (time < this.state.lastCycle + this.params.cycleTime) return;\r\n\r\n        if (this.debugSim && this.id == 0) {\r\n          console.log(\"Start Sensing: \" + time);\r\n        }\r\n\r\n        this.state.state = States.Sensing;\r\n        this.state.startedSensing = time;\r\n        this.state.batch = this.state.batch + 1;\r\n        this.state.aliveCount = 0;\r\n\r\n        // Query our neighbors.\r\n        for(let i=0; i < this.neighbors.length; i++) {\r\n          let msg = {command:Messages.AreYouAlive, batch:this.state.batch};\r\n          this.radio.sendMessage(this.id, this.neighbors[i], msg);\r\n        }\r\n      } else if (this.state.state === States.Sensing) {\r\n        if (time > this.state.startedSensing + this.params.cycleTime) {\r\n          if (this.debugSim && this.id == 0) {\r\n            console.log(\"End Sensing: \" + time)\r\n          }\r\n          // We've collected as many answers as we are going to get\r\n          if (this.state.alive === true && (this.state.aliveCount === 2 || this.state.aliveCount === 3)) {\r\n            this.setAlive(true);\r\n          } else if (this.state.alive === false) {\r\n\r\n            if (this.state.aliveCount === 3) {\r\n              this.setAlive(true);\r\n            } else {\r\n              if (Math.random() < this.params.spontaneousGeneration) {\r\n                //console.log(\"Spontanous Generate\");\r\n                this.setAlive(true);\r\n                if (Math.random() < this.params.resurrectionChance) {\r\n                  //console.log(\"Awake my brothers!\");\r\n                  // Resurrect your neighbors\r\n                  for(let i=0; i < this.neighbors.length; i++) {\r\n                    let msg = {command:Messages.Resurrect};\r\n                    this.radio.sendMessage(this.id, this.neighbors[i], msg);\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          } else {\r\n            this.setAlive(false);\r\n          }\r\n\r\n          this.state.state = States.Idle;\r\n          this.state.lastCycle = time;\r\n          return;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Receive a network message.  Contains from,to,msg properties\r\n    receiveMessage(wrapper) {\r\n      if (this.debugNetwork) {\r\n        console.log(\"Agent: \" + this.id + \" recv: \" + JSON.stringify(wrapper));\r\n      }\r\n\r\n      let msg = wrapper.msg;\r\n\r\n      if (msg.command === Messages.Resurrect) {\r\n        let r = Math.random();\r\n        //console.log(\"Got resurrect.  rolled: \" + r + \" vs: \" + this.params.resurrectionChance);\r\n        if (r < this.params.resurrectionChance) {\r\n          //console.log(\"Jesus!\");\r\n          this.setAlive(true);\r\n        }\r\n      }\r\n\r\n      if (this.state.state !== States.Sensing) {\r\n        if (this.debugNetwork) {\r\n          console.log(\"Agent: \" + this.id + \" ignored.  Not Sensing\");\r\n        }\r\n        // ignore\r\n        return;\r\n      }\r\n\r\n      switch(msg.command) {\r\n        case Messages.ImAlive:\r\n          if (msg.batch !== this.state.batch) {\r\n            // ignore old batch answer\r\n            return;\r\n          }\r\n\r\n          this.state.aliveCount++;\r\n          break;\r\n        case Messages.AreYouAlive:\r\n          if (this.state.alive === true) {\r\n            this.radio.sendMessage(this.id, wrapper.from, {command: Messages.ImAlive, batch: msg.batch})\r\n          }\r\n          // Do not send a message if dead to preserve bandwidth\r\n          break;\r\n      }\r\n    }\r\n  */\r\n\r\n  render() {\r\n    return <div><h1>Game of Life</h1></div>\r\n  }\r\n}\r\n\r\nexport function ConwayControl(props) {\r\n  const [startPattern,setStartPattern] = useState(props.startPattern);\r\n  const [size,setSize] = useState(props.size);\r\n  const [cycleTime, setCycleTime] = useState(props.cycleTime);\r\n  const [spontaneousGeneration, setSpontaneousGeneration] = useState(props.spontaneousGeneration);\r\n  const [resurrectionChance,setResurrectionChance] = useState(props.resurrectionChance);\r\n\r\n  const submit = (evt) => {\r\n    if (evt) evt.preventDefault();\r\n\r\n    props.paramsChangedAction({\r\n      startPattern:startPattern,\r\n      size:size,\r\n      cycleTime:cycleTime,\r\n      spontaneousGeneration:spontaneousGeneration,\r\n      resurrectionChance:resurrectionChance\r\n    });\r\n\r\n    return null;\r\n  };\r\n\r\n  return (\r\n    <div style={{\r\n      width:\"512px\",\r\n      border: \"1px solid black\",\r\n      padding:\"8px\"\r\n    }}>\r\n      <h1>Game of Life - Agent Control</h1>\r\n      <form onSubmit={submit}>\r\n        <Select style={{\r\n          width:\"100%\",\r\n          height:\"56px\",\r\n          margin:\"auto\",\r\n          display:\"block\",\r\n          marginTop:\"24px\",\r\n        }}\r\n          label=\"Start Pattern\" options={[\"random\",\"corners\",\"blank\",\"quadpole\",\"test\"]} value={startPattern} onChange={e => setStartPattern(e.target.value)} />\r\n        <TextField style={{\r\n          width:\"100%\",\r\n          height:\"56px\",\r\n          margin:\"auto\",\r\n          display:\"block\",\r\n          marginTop:\"24px\",\r\n        }}label=\"Size\" required value={size} onChange={e => setSize(parseInt(e.target.value))} />\r\n        <TextField style={{\r\n          width:\"100%\",\r\n          height:\"56px\",\r\n          margin:\"auto\",\r\n          display:\"block\",\r\n          marginTop:\"24px\",\r\n        }}label=\"CycleTime\" required value={cycleTime} onChange={e => setCycleTime(parseInt(e.target.value))} />\r\n        <TextField style={{\r\n          width:\"100%\",\r\n          height:\"56px\",\r\n          margin:\"auto\",\r\n          display:\"block\",\r\n          marginTop:\"24px\",\r\n        }}label=\"Spontaneous Generation\" required value={spontaneousGeneration} onChange={e => setSpontaneousGeneration(e.target.value)} />\r\n        <TextField style={{\r\n          width:\"100%\",\r\n          height:\"56px\",\r\n          margin:\"auto\",\r\n          display:\"block\",\r\n          marginTop:\"24px\",\r\n        }}label=\"Resurrection Chance\" required value={resurrectionChance} onChange={e => setResurrectionChance(e.target.value)} />\r\n        <Button style={{\r\n          width:\"100%\"\r\n        }} type=\"submit\" label=\"Update\" />\r\n      </form>\r\n    </div>\r\n  );\r\n}"]},"metadata":{},"sourceType":"module"}